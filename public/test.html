<html>

<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</head>

<body>
    <h1>
        <p id="hi">hi </p>
    </h1>
    <h3> You're looking awfully preettty today.</h3>
    <div id="container">
        <ul class="list-group" id="semesters" />

    </div>
    <div class="dropdown" id="addSemester">
        <select class="form-control" id="season">
            <option value="Fall">Fall</option>
            <option value="Spring">Spring</option>
            <option value="Summer">Summer</option>
            <option value="Winter">Winter</option>
        </select>
        <input type="number" id="year">
        <button type=button id="submit" onclick="saveUserData()">Save</button>

    </div>
    <div><button type="button" id="signout" onclick="signOut()">Sign Out</button></div>

    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-app.js"></script>
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.2/firebase-firestore.js"></script>
    <script type="text/javascript">
        const firebaseConfig = {
            apiKey: "AIzaSyBgTINIb8EXsm0xYJBDHWrpJ44RgsaIDQU",
            authDomain: "pointaverage-44e7d.firebaseapp.com",
            databaseURL: "https://pointaverage-44e7d.firebaseio.com",
            projectId: "pointaverage-44e7d",
            storageBucket: "pointaverage-44e7d.appspot.com",
            messagingSenderId: "679769712808",
            appId: "1:679769712808:web:27bc0d4096a2feca"
        };

        let currUser;

        function signOut() {
            firebase.auth().signOut();
        }

        function saveUserData() {
            db.collection("users").doc(currUser.uid).collection("Semesters").doc(document.getElementById("season").value.toString() + " " +
                document.getElementById("year").value).set({
                Credits: 0,
                Grades: 0
            });
            document.reload();
        }
        firebase.initializeApp(firebaseConfig);
        let db = firebase.firestore();
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                // User is signed in.
                currUser = user;
                var email = user.email;
                var emailVerified = user.emailVerified;
                var uid = user.uid;
                var providerData = user.providerData;
                document.getElementById("hi").textContent += user.displayName;

                db.collection("users").doc(user.uid).collection("Semesters").get().then(function(querySnapshot) {
                    querySnapshot.forEach(function(doc) {
                        let semester = document.createElement("li");
                        semester.setAttribute('class', "list-group-item");
                        semester.appendChild(document.createTextNode(doc.id));
                        document.getElementById("semesters").appendChild(semester);
                        console.log(doc.id, " => ", doc.data());
                    });
                });
            } else {
                window.location.href = "index.html";
            }
        });

    </script>

</body>

</html>
